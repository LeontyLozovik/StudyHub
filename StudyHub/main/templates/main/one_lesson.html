{% extends 'main/base.html' %}
{% load static %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'main/styles/one_lesson.css' %}">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
{% endblock %}

{% block content %}
<div class="lesson-container mx-auto mt-4">

    <div class="lesson-description">
        <div class="text-center position-relative mb-4">
            <h2 class="lesson-title">{{ lesson.lesson_name }}</h2>
            {% if user == lesson.author %}
                <div class="position-absolute top-0 end-0">
                    <a href="{% url 'update_lesson' lesson.pk %}" class="btn btn-primary btn-sm me-2 text-decoration-none">Update</a>
                    <a href="{% url 'delete_lesson' lesson.pk %}" class="btn btn-danger btn-sm text-decoration-none">Delete</a>
                </div>
            {% endif %}
        </div>
    </div>

    <div class="lesson-description">
        <h5>Description:</h5>
        <p>{{ lesson.description }}</p>
    </div>

    <div class="video-wrapper mb-4">
        {% if lesson.video %}
            <video controls class="w-100 rounded shadow-sm">
                <source src="{{ lesson.video.url }}" type="video/mp4">
                Oops! Looks like your browser can't play this video. Try updating your browser or switching to another one.
            </video>
        {% else %}
            <div class="alert alert-warning text-center">
                Video is missing
            </div>
        {% endif %}
    </div>
</div>
<div class="lesson-container mx-auto mt-4">
    <form method="post" action="{% url 'create_note' lesson.pk %}">
        {% csrf_token %}

        <div class="mb-3">
            <label for="note" class="form-label">Note to lesson:</label>
            <textarea id="note" name="note" class="form-control" rows="4" placeholder="Enter you note..."></textarea>
        </div>

        <div class="form-check mb-3">
            <input type="checkbox" class="form-check-input" id="is_private" name="is_private">
            <label class="form-check-label" for="is_private">Make private</label>
        </div>

        <button type="submit" class="btn btn-success">Create</button>
    </form>
    <div class="d-flex justify-content-start gap-3 mt-3 ps-2">
        <a href="?filter=all"
           class="note-filter-link {% if request.GET.filter == 'all' or not request.GET.filter %}active{% endif %} text-decoration-none">All</a>
        <a href="?filter=my"
           class="note-filter-link {% if request.GET.filter == 'my' %}active{% endif %} text-decoration-none">Only My</a>
        <a href="?filter=private"
           class="note-filter-link {% if request.GET.filter == 'private' %}active{% endif %} text-decoration-none">Only Private</a>
    </div>

    {% if notes %}
        <hr>
        <div class="mt-3">
            {% for note in notes %}
                <div class="border rounded p-3 mb-2 position-relative note-block">
                    {% if note.user == request.user %}
                        <div class="position-absolute top-0 end-0 m-2 d-flex gap-2 edit-controls">
                            <button type="button" class="btn btn-sm bg-secondary text-white edit-btn">
                                <i class="fa-solid fa-pen"></i>
                            </button>

                            <form method="post" action="{% url 'delete_note' note.pk %}" style="margin: 0;">
                                {% csrf_token %}
                                <button type="submit" class="btn btn-sm bg-danger text-white" style="padding: 0.25rem 0.5rem;">
                                    <i class="fa-solid fa-trash"></i>
                                </button>
                            </form>
                        </div>
                    {% endif %}

                    <p class="mb-1 note-content">{{ note.content }}</p>

                    <form method="post" action="{% url 'update_note' note.pk %}" class="edit-form d-none">
                        {% csrf_token %}
                        <textarea name="content" class="form-control mb-2">{{ note.content }}</textarea>
                        <div class="d-flex gap-2">
                            <button type="submit" class="btn btn-success btn-sm">Save</button>
                            <button type="button" class="btn btn-secondary btn-sm cancel-btn">Cancel</button>
                        </div>
                    </form>

                    <small class="text-muted">
                        {{ note.user }} â€” {{ note.created_at|date:"Y-m-d" }}
                    </small>
                </div>

            {% endfor %}
        </div>
    {% endif %}
</div>
{% endblock %}

{% block extra_js %}
<script src="{% static 'main/js/one_lesson.js' %}"></script>
{% endblock %}

